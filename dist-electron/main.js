"use strict";const e=require("electron"),a=require("node:path"),r=require("fs");process.env.DIST=a.join(__dirname,"../dist");process.env.VITE_PUBLIC=e.app.isPackaged?process.env.DIST:a.join(process.env.DIST,"../public");let n;const c=process.env.VITE_DEV_SERVER_URL;function d(){n=new e.BrowserWindow({icon:"icon.ico",width:1920,height:1080,backgroundColor:"#D5F0FF",fullscreen:!0,frame:!1,webPreferences:{preload:a.join(__dirname,"preload.js"),nodeIntegration:!0,contextIsolation:!1}}),n.webContents.on("did-finish-load",()=>{n==null||n.webContents.send("main-process-message",new Date().toLocaleString())}),c?n.loadURL(c):n.loadFile(a.join(process.env.DIST,"index.html"))}e.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(e.app.quit(),n=null)});e.app.on("activate",()=>{e.BrowserWindow.getAllWindows().length===0&&d()});e.app.whenReady().then(d);const p=()=>{const s=new Date().toLocaleDateString("fr-FR").split("/").join("-"),o={title:"Sauvegarder les données client",defaultPath:e.app.getPath("downloads")+("/fichier_client ("+s+")"),filters:[{name:"Fichiers json",extensions:["json"]},{name:"Tous les fichiers",extensions:["*"]}]};n&&e.dialog.showSaveDialog(n,o).then(async t=>{if(t.filePath)try{const i=await r.promises.readFile("./src/data/clients.json","utf-8");await r.writeFile(t.filePath,i,l=>{console.error(l)}),console.log(`Fichier enregistre : ${t.filePath}`)}catch(i){console.error(`Erreur lors de l'enregistrement du fichier : ${i.message}`)}else console.log("Enregistrement annule")})},f=()=>{const s={title:"Importer les données client",defaultPath:e.app.getPath("downloads"),filters:[{name:"Fichiers json",extensions:["json"]},{name:"Tous les fichiers",extensions:["*"]}]};n&&e.dialog.showOpenDialog(n,s).then(async o=>{if(o.filePaths.length>0){const t=o.filePaths[0],i=await r.promises.readFile(t,"utf-8"),l=JSON.parse(i);await r.promises.writeFile("./src/data/clients.json",JSON.stringify(l,null,2)),console.log(`Fichier importe : ${t}`)}else console.log("Importation annulee")})};e.ipcMain.on("export-data",(s,o)=>{p()});e.ipcMain.on("import-data",(s,o)=>{f()});
